<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Smart Medical Quiz</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-bg">
        <div class="card">
            <div class="card-header">Smart Medical Quiz</div>

            <div class="question" id="question-box"></div>

            <div id="options-box" class="options-grid"></div>

            <button id="next-btn" disabled>Question suivante</button>

            <div id="feedback"></div>

            <div class="progress-container">
                <div class="progress-header">Progression</div>
                <div class="progress-bar-wrap">
                    <div id="progress-bar"></div>
                    <div id="progress-bubble"></div>
                </div>
                <div id="progress-percent"></div>
            </div>
        </div>
    </div>

<script>
let questions = [];
let currentQuestionIndex = 0;
let correctCount = 0;
let wrongCount = 0;

fetch("questions.csv")
    .then(res => res.text())
    .then(data => {
        const lines = data.trim().split("\n").slice(1);
        questions = lines.map(line => {
            const [q, o1, o2, o3, o4, correct, exp] = line.split(",");
            return {
                question: q,
                options: [o1, o2, o3, o4],
                correct: correct,
                explanation: exp
            };
        });
        showQuestion();
    });

function showQuestion() {
    const q = questions[currentQuestionIndex];
    document.getElementById("question-box").textContent = q.question;
    const optionsBox = document.getElementById("options-box");
    optionsBox.innerHTML = "";
    const colors = ["#E2D8FF", "#B9F3E4", "#FFE6A7", "#FFC4DD"];
    q.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "option-tile";
        btn.style.backgroundColor = colors[index % colors.length];
        btn.onclick = () => selectAnswer(opt);
        optionsBox.appendChild(btn);
    });
    document.getElementById("feedback").innerHTML = "";
    document.getElementById("next-btn").disabled = true;
}

function selectAnswer(selected) {
    const q = questions[currentQuestionIndex];
    const feedback = document.getElementById("feedback");
    if (selected === q.correct) {
        correctCount++;
        feedback.innerHTML = "<p><strong>Bonne réponse !</strong></p><p>" + q.explanation + "</p>";
    } else {
        wrongCount++;
        feedback.innerHTML = "<p><strong>Mauvaise réponse.</strong></p><p>" + q.explanation + "</p>";
    }
    document.getElementById("next-btn").disabled = false;
    updateProgress();
}

function updateProgress() {
    const total = questions.length;
    const current = currentQuestionIndex + 1;
    const percent = Math.round((current / total) * 100);
    document.getElementById("progress-bar").style.width = percent + "%";
    document.getElementById("progress-bubble").style.left = `calc(${percent}% - 10px)`;
    document.getElementById("progress-percent").textContent = percent + "% terminé";
}

document.getElementById("next-btn").onclick = () => {
    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
        showQuestion();
    } else {
        document.getElementById("question-box").innerHTML = "<p>Quiz terminé. Merci pour votre participation !</p>";
        document.getElementById("options-box").innerHTML = "";
        document.getElementById("feedback").innerHTML = "";
        document.getElementById("next-btn").style.display = "none";
    }
};
</script>
</body>
</html>
