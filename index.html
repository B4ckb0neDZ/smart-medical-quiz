<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Smart Medical Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="main-bg">
  <div class="card">
    <div class="card-header">Smart Medical Quiz</div>
    <div id="quiz-container">
      <div class="question" id="question-box"></div>
      <div id="options-box" class="options-grid"></div>
      <button id="next-btn" disabled>Question suivante</button>
      <div id="feedback"></div>
      <div class="progress-container">
        <div class="progress-header">Progression</div>
        <div class="progress-bar-wrap">
          <div id="progress-bar"></div>
          <div id="progress-bubble"></div>
        </div>
        <div id="progress-percent"></div>
      </div>
    </div>
    <div id="summary" class="summary hidden"></div>
  </div>
</div>
<script>
let questions = [];
let currentQuestionIndex = 0;
let correctCount = 0;
let wrongCount = 0;
let results = [];

fetch("questions.csv")
  .then(res => res.text())
  .then(data => {
    const lines = data.trim().split("\n").slice(1);
    questions = lines.map(line => {
      const [q, o1, o2, o3, o4, correct, exp] = line.split(",");
      return {
        question: q,
        options: [o1, o2, o3, o4],
        correct: correct,
        explanation: exp
      };
    });
    showQuestion();
  });

function showQuestion() {
  const q = questions[currentQuestionIndex];
  document.getElementById("question-box").textContent = q.question;
  const optionsBox = document.getElementById("options-box");
  optionsBox.innerHTML = "";
  const colors = ["#E2D8FF", "#B9F3E4", "#FFE6A7", "#FFC4DD"];
  q.options.forEach((opt, index) => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "option-tile";
    btn.style.backgroundColor = colors[index % colors.length];
    btn.onclick = () => selectAnswer(opt);
    optionsBox.appendChild(btn);
  });
  document.getElementById("feedback").innerHTML = "";
  document.getElementById("next-btn").disabled = true;
}

function selectAnswer(selected) {
  const q = questions[currentQuestionIndex];
  const feedback = document.getElementById("feedback");
  const isCorrect = selected === q.correct;
  if (isCorrect) {
    correctCount++;
    feedback.innerHTML = "<p><strong>Bonne réponse !</strong></p><p>" + q.explanation + "</p>";
  } else {
    wrongCount++;
    feedback.innerHTML = "<p><strong>Mauvaise réponse.</strong></p><p>" + q.explanation + "</p>";
  }
  results.push({question: q.question, correct: isCorrect});
  document.getElementById("next-btn").disabled = false;
  updateProgress();
}

function updateProgress() {
  const total = questions.length;
  const current = currentQuestionIndex + 1;
  const percent = Math.round((current / total) * 100);
  document.getElementById("progress-bar").style.width = percent + "%";
  document.getElementById("progress-bubble").style.left = `calc(${percent}% - 10px)`;
  document.getElementById("progress-percent").textContent = percent + "% terminé";
}

document.getElementById("next-btn").onclick = () => {
  currentQuestionIndex++;
  if (currentQuestionIndex < questions.length) {
    showQuestion();
  } else {
    document.getElementById("quiz-container").classList.add("hidden");
    showSimpleSummary();
  }
};


function showSimpleSummary() {
  const container = document.getElementById("summary");
  container.classList.remove("hidden");
  const percent = Math.round((correctCount / questions.length) * 100);
  container.innerHTML = `
    <div class="card-header">Smart Medical Quiz</div>
    <div class="card-header">Quiz terminé</div>
    <p class="thanks">Merci pour votre participation !</p>
    <div class="donut">
      <svg width="100" height="100" viewBox="0 0 36 36">
        <path class="circle-bg" d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
        <path class="circle" stroke-dasharray="` + percent + `, 100"
          d="M18 2.0845
            a 15.9155 15.9155 0 0 1 0 31.831
            a 15.9155 15.9155 0 0 1 0 -31.831"/>
        <text x="18" y="20.35" class="percentage" text-anchor="middle">
          ` + percent + `%
        </text>
      </svg>
    </div>
  `;
}
 {
  const container = document.getElementById("summary");
  container.classList.remove("hidden");
  container.innerHTML = `
    <div class="card-header">Quiz terminé</div>
    <p class="thanks">Merci pour votre participation !</p>
    <div class="question-summary">
      ${results.map((r, i) => `
        <div class="summary-item">
          <span><strong>Question ${i + 1}</strong> : ${r.correct ? '✅ Réussie' : '❌ Non réussie'}</span>
        </div>
      `).join("")}
    </div>
    <div class="donut">
      <svg width="100" height="100" viewBox="0 0 36 36">
        <path class="circle-bg" d="M18 2.0845
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"/>
        <path class="circle" stroke-dasharray="${Math.round((correctCount / questions.length) * 100)}, 100"
          d="M18 2.0845
            a 15.9155 15.9155 0 0 1 0 31.831
            a 15.9155 15.9155 0 0 1 0 -31.831"/>
        <text x="18" y="20.35" class="percentage" text-anchor="middle">
          ${Math.round((correctCount / questions.length) * 100)}%
        </text>
      </svg>
    </div>
  `;
}
</script>
</body>
</html>
